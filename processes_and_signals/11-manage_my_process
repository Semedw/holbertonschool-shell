#!/usr/bin/env bash
#blablabla

# --- Configuration ---
SERVICE_NAME="manage_my_process"
PID_FILE="/var/run/my_process.pid"
# Assuming manage_my_process is in the same directory as this script
PATH_TO_SERVICE="./$SERVICE_NAME"
# ---------------------

# Function to start the process
start() {
    echo -n "Starting $SERVICE_NAME..."
    # Execute the service in the background (&) and redirect stdout/stderr to /dev/null
    nohup "$PATH_TO_SERVICE" > /dev/null 2>&1 &
    
    # Get the PID of the last background command ($!) and save it to the PID file
    echo $! > "$PID_FILE"
    echo " started"
}

# Function to stop the process
stop() {
    echo -n "Stopping $SERVICE_NAME..."
    
    # Check if PID file exists
    if [ -f "$PID_FILE" ]; then
        # Read the PID from the file
        PID=$(cat "$PID_FILE")
        
        # Send the termination signal (SIGTERM) to the process
        # FIX: Double quote $PID (SC2086)
        kill "$PID" 2> /dev/null
        
        # Delete the PID file
        rm -f "$PID_FILE"
        echo " stopped"
    else
        # If the file doesn't exist, the process might not be running
        echo " (PID file not found. Process may not be running.)"
    fi
}

# Function to restart the process
restart() {
    # It's cleaner to explicitly call stop then start
    stop
    # Wait briefly to ensure the previous process has time to terminate
    sleep 1
    start
    echo "$SERVICE_NAME restarted"
}

# --- Main Logic (Case Statement) ---

case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    restart)
        restart
        ;;
    *)
        # Display usage if argument is not start, stop, or restart
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac

exit 0
